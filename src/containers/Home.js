import React, { useState, useEffect } from "react";
import { PageHeader, ListGroup, ListGroupItem } from "react-bootstrap";
import { useAppContext } from "../libs/contextLib";
import { onError } from "../libs/errorLib";
import "./Home.css";
import { API } from "aws-amplify";
import { LinkContainer } from "react-router-bootstrap";


export default function Home() {
  const [notes, setNotes] = useState([]);
  const { isAuthenticated } = useAppContext();
  const [isLoading, setIsLoading] = useState(true);

  useEffect(() => {
    async function onLoad() {
      if (!isAuthenticated) {
        return;
      }
  
      try {
        const notes = await loadNotes();
        setNotes(notes);
      } catch (e) {
        onError(e);
      }
  
      setIsLoading(false);
    }
  
    onLoad();
  }, [isAuthenticated]);
  
  function loadNotes() {
    return API.get("notes", "/notes");
  }

  function renderNotesList(notes) {
    return [{}].concat(notes).map((note, i) =>
      i !== 0 ? (
        <LinkContainer key={note.noteId} to={`/notes/${note.noteId}`}>
          <ListGroupItem header={note.content.trim().split("\n")[0]}>
            {"Created: " + new Date(note.createdAt).toLocaleString()}
          </ListGroupItem>
        </LinkContainer>
      ) : (
        <LinkContainer key="new" to="/notes/new">
          <ListGroupItem>
            <h4>
              <b>{"\uFF0B"}</b> Create a new note
            </h4>
          </ListGroupItem>
        </LinkContainer>
      )
    );
  }

  function renderLander() {
    return (
      <div className="lander">
          <svg xmlns="http://www.w3.org/2000/svg" width="250" height="60" viewBox="0 0 177 40" style={{paddingRight: 47, fontSize: 28}}>
          <g fill="#000000" transform="translate(42.58 6.452)">
          <path d="M.258064516 21.1935484L1.35483871 20.9677419C2.32258065 20.7096774 2.58064516 20.5806452 2.58064516 18.6451613L2.58064516 3.4516129C2.58064516 1.51612903 2.29032258 1.35483871 1.35483871 1.12903226L.258064516.903225806.258064516 0 17.7419355 0 18.0645161 6.41935484 17.0645161 6.41935484C16.2580645 4.64516129 15.7419355 3.70967742 15.2580645 3 14.2258065 1.51612903 13.5483871 1.38709677 11.3225806 1.38709677 9.67741935 1.38709677 8.87096774 1.58064516 8.38709677 1.70967742L8.38709677 9.93548387 9.25806452 9.93548387C11.516129 9.93548387 12.0322581 9.67741935 12.4193548 8.96774194 12.8709677 8.16129032 13.1290323 7.5483871 13.4193548 6.51612903L14.3870968 6.51612903 14.3870968 14.8387097 13.4193548 14.8387097C13.1290323 13.8387097 12.8709677 13.1935484 12.4193548 12.2580645 12.0322581 11.4516129 11.6129032 11.2903226 9.25806452 11.2903226L8.38709677 11.2903226 8.38709677 17.483871C8.38709677 20.3548387 8.48387097 20.6774194 11.6129032 20.6774194 14.1935484 20.6774194 14.7096774 20.3548387 15.7741935 18.7741935 16.3548387 17.9032258 16.9677419 16.5483871 17.8064516 14.516129L18.8387097 14.516129 18.3870968 22.0967742.290322581 22.0967742.258064516 21.1935484zM21.5483871 9.09677419C20.8064516 7.29032258 20.4516129 6.83870968 19.6451613 6.58064516L19.0322581 6.38709677 19.0322581 5.5483871 28.6129032 5.5483871 28.6129032 6.38709677 27.7419355 6.61290323C27.0645161 6.80645161 26.7419355 7.12903226 26.7419355 7.90322581 26.7419355 8.35483871 26.9032258 8.90322581 27.1612903 9.61290323L29.8387097 16.9677419 30 16.9677419 32.5806452 9.61290323C32.8709677 8.83870968 33 8.29032258 33 7.83870968 33 7.12903226 32.6774194 6.77419355 32 6.61290323L31.1290323 6.38709677 31.1290323 5.5483871 37.0322581 5.5483871 37.0322581 6.38709677 36.4193548 6.58064516C35.5806452 6.87096774 35.2258065 7.35483871 34.4516129 9.4516129L29.516129 22.0967742 26.8064516 22.0967742 21.5483871 9.09677419zM36.2903226 13.7419355C36.2903226 8.19354839 40.3870968 5.12903226 44.6129032 5.12903226 49 5.12903226 51.7419355 7.32258065 51.8387097 13.0967742L41.2903226 13.0967742C41.3870968 18.3225806 43.3548387 19.7419355 46.6451613 19.7419355 48.6129032 19.7419355 50.1290323 19.1612903 51.3225806 18.5483871L51.3225806 19.6129032C50.1935484 20.8387097 47.7741935 22.516129 44.5806452 22.516129 39.0322581 22.4516129 36.2903226 19.1612903 36.2903226 13.7419355zM41.2903226 11.8709677L46.7419355 11.5806452C46.7419355 7.74193548 46.2258065 6.32258065 44.3225806 6.32258065 42.7096774 6.32258065 41.4193548 7.87096774 41.2903226 11.8709677zM60.2258065 7.58064516C61.1290323 6.61290323 62.9677419 5.03225806 65.0967742 5.03225806 66.4516129 5.03225806 67.5806452 6.12903226 67.5806452 7.51612903 67.5806452 8.90322581 66.483871 10 65.0967742 10 64.0967742 10 63.1935484 9.38709677 62.8387097 8.51612903 62.6451613 8.16129032 62.2258065 8.06451613 61.9354839 8.06451613 61.3548387 8.06451613 60.6774194 8.48387097 60.2580645 8.87096774L60.2580645 19.1935484C60.2580645 20.6774194 60.3870968 20.8387097 61.3548387 21L62.4193548 21.2258065 62.4193548 22.0967742 53.2258065 22.0967742 53.2258065 21.2258065 54.0645161 21C55.1290323 20.7096774 55.2580645 20.5483871 55.2580645 19.1935484L55.2580645 9.29032258C55.2580645 7.93548387 55.0967742 7.83870968 54.1935484 7.22580645L53.1290323 6.51612903 53.1290323 5.87096774 59.8387097 5.09677419 60.1935484 5.35483871 60.1290323 7.5483871 60.2258065 7.58064516M68.5483871 21.2258065L69.3870968 21C70.4516129 20.7096774 70.5806452 20.5483871 70.5806452 19.1935484L70.5806452 9.29032258C70.5806452 7.93548387 70.4193548 7.83870968 69.516129 7.22580645L68.4516129 6.51612903 68.4516129 5.87096774 75.1612903 5.09677419 75.516129 5.32258065 75.4516129 7.35483871 75.5806452 7.35483871C77.2580645 6.16129032 79.3548387 5.09677419 81.6774194 5.09677419 84.3870968 5.09677419 85.8387097 6.48387097 85.8387097 9.35483871L85.8387097 19.1612903C85.8387097 20.5483871 85.9677419 20.7096774 87 20.9677419L87.8387097 21.1935484 87.8387097 22.0645161 78.9677419 22.0645161 78.9677419 21.1935484 79.7419355 21C80.7096774 20.7419355 80.8064516 20.6451613 80.8064516 19.1612903L80.8064516 10.6129032C80.8064516 8.67741935 80.0967742 8.06451613 78.6129032 8.06451613 77.483871 8.06451613 76.3548387 8.32258065 75.6451613 8.48387097L75.6451613 19.1935484C75.6451613 20.7096774 75.7419355 20.7741935 76.7096774 21.0322581L77.483871 21.2258065 77.483871 22.0967742 68.6129032 22.0967742 68.6129032 21.2258065 68.5483871 21.2258065zM88.4516129 13.8387097C88.4516129 7.74193548 92.7741935 5.12903226 97.0645161 5.12903226 101.677419 5.12903226 105.709677 7.90322581 105.709677 13.6774194 105.709677 19.7741935 101.451613 22.4516129 97.0645161 22.4516129 92.4516129 22.4516129 88.4516129 19.6774194 88.4516129 13.8387097zM100.354839 14C100.354839 7.58064516 99.1290323 6.35483871 96.9354839 6.35483871 94.9354839 6.35483871 93.7419355 7.80645161 93.7419355 13.2903226 93.7419355 19.8064516 94.8064516 21.2258065 97.1290323 21.2258065 99.0322581 21.2258065 100.354839 20.0967742 100.354839 14zM108.451613 18.0645161L108.451613 7.41935484 106.451613 7.41935484 106.451613 6.64516129C108.935484 5.67741935 110.83871 3.83870968 111.741935 1.29032258L113.548387 1.29032258 113.548387 5.5483871 117.774194 5.5483871 117.354839 7.41935484 113.548387 7.41935484 113.548387 17.7419355C113.548387 19.3225806 114.032258 19.9677419 115.612903 19.9677419 116.387097 19.9677419 117.322581 19.8064516 117.903226 19.6774194L117.903226 20.5806452C117.129032 21.2903226 115.548387 22.4516129 112.870968 22.4516129 110 22.4516129 108.451613 21.1935484 108.451613 18.0645161zM118.548387 13.7419355C118.548387 8.19354839 122.645161 5.12903226 126.870968 5.12903226 131.258065 5.12903226 134 7.32258065 134.096774 13.0967742L123.580645 13.0967742C123.677419 18.3225806 125.645161 19.7419355 128.935484 19.7419355 130.903226 19.7419355 132.419355 19.1612903 133.612903 18.5483871L133.612903 19.6129032C132.483871 20.8387097 130.064516 22.516129 126.870968 22.516129 121.290323 22.4516129 118.548387 19.1612903 118.548387 13.7419355zM123.548387 11.8709677L129 11.5806452C129 7.74193548 128.483871 6.32258065 126.580645 6.32258065 124.967742 6.32258065 123.677419 7.87096774 123.548387 11.8709677z"></path>
          </g>
          </svg>
          <p class= "tagline">A simple note taking app</p> 
      </div>
    );
  }

  function renderNotes() {
    return (
      <div className="notes">
        <PageHeader>Your Notes</PageHeader>
        <ListGroup>
          {!isLoading && renderNotesList(notes)}
        </ListGroup>
      </div>
    );
  }

  return (
    <div className="Home">
      {isAuthenticated ? renderNotes() : renderLander()}
    </div>
  );
}